= Описание системы

== Назначение системы

Система управления документами и бизнес-процессами {dv} (Система) -- программный комплекс для автоматизации документооборота организации и выполнения связанных с этим процессов.

.{dv} предоставляет следующие возможности:
* Создавать и хранить документы в электронном виде.
* Создавать задания для сотрудников, контролировать исполнение заданий.
* Согласовывать документы.
* Разграничивать права доступа к объектам с использованием нескольких моделей безопасности.
* Автоматизировать процессы электронного документооборота и бизнес-процессы организации.
* Протоколировать работу пользователей.
* Настраивать работу объектов и процессов без программирования.
* Работать с открытым API.

Система {dv} имеет модульную архитектуру: группы функций Системы вынесены в отдельные модули.

В зависимости от типа выполняемых функций модули делятся на базовые и дополнительные.

== Общая структура {dv}

Система {dv} обладает классической трехуровневой архитектурой, включающей: клиентское приложение, сервер и базу данных.

.Трёхуровневая архитектура {dv}
[plantuml, svg]
....
@startuml
hide empty members

package "Клиент" as client #DDDDDD {

    class "Windows-клиент" as wincl
    class "Web-клиент" as webc
    class "Другие клиенты" as otcl {
        +Пульс
        +Почтовый клиент
        +Прочие
}

}

package "Сервер" as server #DDFFFF {
    class "Сервер Docsvision" as platform
    class "СУБП" as workflow
    class "Сервис полнотекстового \nиндексирования" as fulltext
    class "Файловый сервис" as fileservice
}

package "Данные" as data #AAFFFF {
  class "СУБД" as db
}

wincl << К,#FF7700 >>
webc << К,#FF7700 >>
otcl << К,#FF7700 >>

wincl -[hidden]> webc
webc -[hidden]> otcl
client -[hidden]-> server
server -[hidden]-> data

platform -[hidden]-> workflow
platform -[hidden]> fulltext
fulltext -[hidden]> fileservice

platform << С,#DD9955 >>
workflow << С,#DD9955 >>
fulltext << С,#DD9955 >>
fileservice << С,#FF9900 >>

db << Д,#5570dd >>

client -down[hidden]-> server
server -down[hidden]-> data
@enduml
....

=== Клиентское приложение

.Для работы с системой {dv} пользователь может использовать:
* Стандартные клиенты: {wincl} или {wc}ю
* Специальные клиенты: Пульс -- программа для мобильных устройств, Почтовый клиент -- позволяет выполнять задания с помощью почтовой программы и др.


=== Сервер {dv}

.Сервер {dv} реализован в виде двух сервисов:

* Веб-служба IIS -- предоставляет доступ клиентам по протоколу `SOAP`, а также реализует стиль взаимодействия `REST`.
* Служба Windows -- предоставляет доступ клиентам по протоколу `WCF`.

.Также на уровне сервера работают:
* Служба СУБП (система управления бизнес-процессами).
* Сервис полнотекстового индексирования -- обеспечивает возможность использования полнотекстового поиска по данным.
* Файловый сервис -- выполняет отложенные операции удаления бинарных данных файлов из внешних хранилищ, и перемещает данные между хранилищами.

Сервер {dv}, СУБП и Сервис полнотекстового индексирования могут масштабироваться. Для этого несколько элементов одного типа объединяются в кластер.

.Кластер сервисов {dv}
[plantuml, svg]
....
@startuml
hide empty members


package "Сервер" as server #DDFFFF {

    class "Кластер серверов" as platform ##[dashed] {
        +Сервер 1
        +Сервер 2...
}
    class "Кластер СУБП" as workflow ##[dashed] {
        +Сервис 1
        +Сервис 2...
}
    class "Кластер cервисов полнотекстового \nиндексирования" as fulltext ##[dashed] {
        +СУБП 1
        +СУБП 2...
}
}

platform -[hidden]> workflow
platform -[hidden]> fulltext

platform << С,#DD9955 >>
workflow << С,#DD9955 >>
fulltext << С,#DD9955 >>

@enduml
....

=== База данных

Основным хранилищем данных в {dv} является база данных. В качестве СУБД поддерживаются Microsoft SQL или PostgreSQL. В более сложных конфигурациях могут быть добавлены xref:platform:admin:redisCache.adoc[кэш-сервер Redis], а также выделенные xref:platform:admin:storage.adoc[хранилища для бинарных данных] (содержимого) файлов.

.Конфигурация {dv} с внешними хранилищами и Redis
[plantuml, svg]
....
@startuml
hide empty members

package "Данные" as data #AAFFFF {
    class "СУБД" as db
    class "Внешние файловые хранилища" as ext ##[dashed] {
        +Хранилище 1
        +Хранилище 2
        +Хранилище N
}
    class "Кэш-сервер Redis" as redis
}

db -[hidden]> ext
ext -[hidden]> redis

db << Д,#5570dd >>
ext << Д,#5570dd >>
redis << Д,#5570dd >>

@enduml
....

== Схема взаимодействия основных элементов Системы

image::interactionScheme.png[]

== Основные объекты системы

Основными объектами {dv} являются карточки и файлы.

.Схема взаимодействия основных элементов Системы
[plantuml, svg]
....
@startuml
database "База Данных"

package "Сервер Docsvision" as server {
    [Служба \nDocsvision 5.5 Storage Server]
    [Web-сервис Docsvision в IIS]
}

component "Внешнее файловое хранилище" as ext

component "Файловый сервис (Служба \nDocsvision 5.5 File Service)" as fileservice

component "Сервис полнотекстового индексирования \nСлужба \nDocsvision 5.5 Full-text Indexing Service" as fulltext

component "СУБП (Служба \nDocsvision 5.5 Workflow Server)" as workflow

component "Клиенты, \nработающие \nчерез SOAP" as soap

component "Клиенты, \nработающие \nчерез WCF" as wcf

skinparam databaseBackgroundColor Aqua

@enduml

....

=== Карточки

Карточки -- элементы систем, предназначенные для упорядоченного хранения сведений о внешних объектах и процессах.

Карточка {dv} включает две составляющие: данные и, необязательный, пользовательский интерфейс.

Данные карточки представляют собой набор простейших элементов -- _полей_, сгруппированных в _секции_.

Поле является элементарной единицей хранения данных в {dv}. Тип информации, которая может хранится в _поле_, определяется типом поля. Например, есть типы полей для хранения строковых или числовых данных, даты и времени, значения "Да/нет" и др. Также настройки полей могут устанавливать другие ограничения для хранимой информацию, а именно: максимальный размер для текстовых данных, обязательность наличия данных в поле при сохранения карточки. Специальные типы полей предназначены для хранения ссылки на карточки или данные карточек -- _ссылочные поля_.

С помощью секций формируются группы полей, к которым применяются особые правила секции. Основным правилом является тип секции, который определяется структуру полей секции:

* плоская -- в секции может храниться одна строка с данными полей секции;

image::sectionStruct.png[sectionStruct]

* коллекционная (табличная) -- в секции может храниться одна или несколько отдельных строк с данными полей секции;

image::sectionTable.png[sectionTable]

* иерархическая (древовидная) -- в секции может храниться одна или несколько строк с данными полей секции, отдельные строки могут являться подстроками других строк.

image::sectionTree.png[sectionTree]

В свою очередь секция может являться подчинённой по отношению к другой секции.

image::subSection.png[subSection]

Перечень и параметры секций и полей карточки формируют её описание -- _тип карточки_ (в терминах {dv}). Созданные по описанию карточки называются _экземплярами карточек_.

____

Описание схем стандартных карточек {dv} приведено в xref:Documentations.adoc[Перечень эксплуатационной документации] "Описание полей стандартных карточек {dv}".

____

Физически экземпляры карточек хранятся в БД {dv} в таблицах `dvtable_{Идентификатор секции}` -- в каждой таблице хранятся данные одной секции всех карточек одного типа. Описание, общая и системная информация о карточке хранится в отдельных таблицах: `dvsys_instances`, `dvsys_instances_date` и некоторых других. Описание таблиц БД {dv} приведено в пункте xref:Tables.adoc[Таблицы БД {dv}].

image::dbAndCards.png[dbAndCards]

Схемы карточек в формате XML хранятся в таблице `dvsys_carddefs`.

Частным случаем карточки является _справочник_ -- тип карточки, у которой может быть только один экземпляр. Данные справочников, как правило, используются в других карточках (через _ссылочные поля_).

=== Библиотеки карточек

_Библиотека карточек_ -- коллекция типов карточек, которая требуется для загрузки карточек в {dv} и их обновления. Как правило, в библиотеку включаются все карточки одного модуля {dv}.

=== Файлы

В системе {dv} файл представлен на двух уровнях:

. На более низком -- бинарные данные файла и его атрибуты (размер, дата создания и изменения, признаки архивирования и предварительного удаления и др.).
. На более высоком -- _Карточка файла с версиями_ -- содержит ссылки на версии файла, а именно на бинарные данные разных версий, номера версий, комментарии к версиям и данные авторов версий.

_Карточка файла с версиями_ используется для хранения файлов, прикрепляемых к карточкам {dv}. В системных целях {dv} работает непосредственно с файлами.

Карточки файлов с версиями и атрибуты файлов хранятся в БД {dv}, а бинарные данные могут хранится в БД или в отдельном хранилище вне БД {dv}. Более подробно внешнее хранение бинарных данных рассмотрено в пункте xref:BinaryStorage.adoc[Хранение бинарных данных файлов].

image::filesStruct.png[filesStruct]