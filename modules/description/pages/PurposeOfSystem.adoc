= Описание системы

== Назначение системы

Система управления документами и бизнес-процессами {dv} (Система) – программный комплекс для автоматизации документооборота организации и выполнения связанных с этим процессов.

.{dv} предоставляет следующие функции:
* Создание и хранение документов в электронном виде.
* Создание заданий для сотрудников c контролем исполнения.
* Согласование документов.
* Разграничение прав доступа к объектам с использованием нескольких моделей безопасности.
* Автоматизация процессов электронного документооборота и бизнес-процессов организации.
* Протоколирование работы пользователей.
* Настройка работы объектов и процессов "без программирования".
* Открытый API для программистов.

Система {dv} имеет модульную архитектуру: группы функций Системы вынесены в отдельные модули.

В зависимости от типа выполняемых функций модули делятся на базовые и дополнительные.

== Общая структура {dv}

Система {dv} обладает классической трехуровневой архитектурой, включающей: клиентское приложение, сервер и базу данных.

image::simpleArch.png[]

* *Клиентское приложение.*

Для работы с системой {dv} пользователь может использовать:

* стандартные клиенты: Windows-клиент или Web-клиент;
* специальные клиенты: Пульс (программа для мобильных устройств), Почтовый клиент (позволяет выполнять задания с помощью почтовой программы) и др.
* *Сервер {dv}*.

Сервер {dv} реализован в виде двух сервисов:

* веб-служба IIS – предоставляет доступ клиентам по протоколу SOAP, а также реализует стиль взаимодействия REST;
* служба Windows – предоставляет доступ клиентам по протоколу WCF.

Также на уровне сервера работают:

* служба СУБП (система управления бизнес-процессами);
* сервис полнотекстового индексирования – обеспечивает возможность использования полнотекстового поиска по данным;
* файловый сервис – выполняет отложенные операции удаления бинарных данных файлов из внешних хранилищ, и перемещает данные между хранилищами.

"Сервер {dv}", СУБП и Сервис полнотекстового индексирования могут масштабироваться. Для этого несколько элементов одного типа объединяются в кластер.

image::archCluster.png[]

* *База данных*.

Основным хранилищем данных в {dv} является база данных. В качестве СУБД поддерживаются Microsoft SQL или PostgreSQL. В более сложных конфигурациях могут быть добавлены кэш-сервер "Redis", а также выделенные хранилища для бинарных данных (содержимого) файлов.

image::archStorages.png[]

== Схема взаимодействия основных элементов Системы

image::interactionScheme.png[]

== Основные объекты системы

Основными объектами {dv} являются карточки и файлы.

=== Карточки

Карточки – элементы систем, предназначенные для упорядоченного хранения сведений о внешних объектах и процессах.

Карточка {dv} включает две составляющие: данные и, необязательный, пользовательский интерфейс.

Данные карточки представляют собой набор простейших элементов – _полей_, сгруппированных в _секции_.

Поле является элементарной единицей хранения данных в {dv}. Тип информации, которая может хранится в _поле_, определяется типом поля. Например, есть типы полей для хранения строковых или числовых данных, даты и времени, значения "Да/нет" и др. Также настройки полей могут устанавливать другие ограничения для хранимой информацию, а именно: максимальный размер для текстовых данных, обязательность наличия данных в поле при сохранения карточки. Специальные типы полей предназначены для хранения ссылки на карточки или данные карточек – _ссылочные поля_.

С помощью секций формируются группы полей, к которым применяются особые правила секции. Основным правилом является тип секции, который определяется структуру полей секции:

* плоская – в секции может храниться одна строка с данными полей секции;

image::sectionStruct.png[sectionStruct]

* коллекционная (табличная) – в секции может храниться одна или несколько отдельных строк с данными полей секции;

image::sectionTable.png[sectionTable]

* иерархическая (древовидная) – в секции может храниться одна или несколько строк с данными полей секции, отдельные строки могут являться подстроками других строк.

image::sectionTree.png[sectionTree]

В свою очередь секция может являться подчинённой по отношению к другой секции.

image::subSection.png[subSection]

Перечень и параметры секций и полей карточки формируют её описание – _тип карточки_ (в терминах {dv}). Созданные по описанию карточки называются _экземплярами карточек_.

____

Описание схем стандартных карточек {dv} приведено в xref:Documentations.adoc[Перечень эксплуатационной документации] "Описание полей стандартных карточек {dv}".

____

Физически экземпляры карточек хранятся в БД {dv} в таблицах `dvtable_{Идентификатор секции}` – в каждой таблице хранятся данные одной секции всех карточек одного типа. Описание, общая и системная информация о карточке хранится в отдельных таблицах: `dvsys_instances`, `dvsys_instances_date` и некоторых других. Описание таблиц БД {dv} приведено в пункте xref:Tables.adoc[Таблицы БД {dv}].

image::dbAndCards.png[dbAndCards]

Схемы карточек в формате XML хранятся в таблице `dvsys_carddefs`.

Частным случаем карточки является _справочник_ – тип карточки, у которой может быть только один экземпляр. Данные справочников, как правило, используются в других карточках (через _ссылочные поля_).

=== Библиотеки карточек

_Библиотека карточек_ – коллекция типов карточек, которая требуется для загрузки карточек в {dv} и их обновления. Как правило, в библиотеку включаются все карточки одного модуля {dv}.

=== Файлы

В системе {dv} файл представлен на двух уровнях:

. На более низком – бинарные данные файла и его атрибуты (размер, дата создания и изменения, признаки архивирования и предварительного удаления и др.).
. На более высоком – _Карточка файла с версиями_ – содержит ссылки на версии файла, а именно на бинарные данные разных версий, номера версий, комментарии к версиям и данные авторов версий.

_Карточка файла с версиями_ используется для хранения файлов, прикрепляемых к карточкам {dv}. В системных целях {dv} работает непосредственно с файлами.

Карточки файлов с версиями и атрибуты файлов хранятся в БД {dv}, а бинарные данные могут хранится в БД или в отдельном хранилище вне БД {dv}. Более подробно внешнее хранение бинарных данных рассмотрено в пункте xref:BinaryStorage.adoc[Хранение бинарных данных файлов].

image::filesStruct.png[filesStruct]
